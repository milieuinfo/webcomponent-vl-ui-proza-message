import{VlElement,define}from"/node_modules/vl-ui-core/vl-core.js";import"/node_modules/vl-ui-button/vl-button.js";import"/node_modules/vl-ui-icon/vl-icon.js";export class VlProzaMessage extends(VlElement(HTMLElement)){static get _observedAttributes(){return["data-vl-domain","data-vl-code"]}constructor(){super("\n            <style>\n                @import '/node_modules/vl-ui-button/style.css';\n                @import '/node_modules/vl-ui-icon/style.css';\n                \n                :host > div {\n                    display: inline;\n                }\n            </style>\n            <div>\n                <span id=\"content\"></span>\n            </div>\n        ")}connectedCallback(){this.__processToegelatenOperaties()}get _contentElement(){return this._element.querySelector("#content")}_getEditButtonTemplate(){return this._template('\n            <button is="vl-button-link" type="button">\n                <span is="vl-icon" icon="edit"></span>\n            </button>\n        ')}_data_vl_domainChangedCallback(){this._loadMessage()}_data_vl_codeChangedCallback(){this._loadMessage()}get _domain(){return this.dataset.vlDomain}get _code(){return this.dataset.vlCode}_loadMessage(){this._domain&&this._code?VlProzaMessage._getMessage(this._domain,this._code).then(e=>this._contentElement.innerHTML=e):this._contentElement.innerHTML=null}static _getMessage(e,t){return VlProzaMessagePreloader.getMessage(e,t).catch(()=>VlProzaMessage._getSingleMessage(e,t))}static _getSingleMessage(e,t){const a=VlProzaMessage.__getMessageCacheForDomain(e);return a[t]||(a[t]=ProzaRestClient.getMessage(e,t)),a[t]}static _getToegelatenOperaties(e){let t=VlProzaMessage.__getToegelatenOperatiesCacheForDomain(e);return t||(t=ProzaRestClient.getToegelatenOperaties(e),VlProzaMessage.__setToegelatenOperatiesCacheForDomain(e,t)),t}static get __domainCache(){return VlProzaMessage.__cache||(VlProzaMessage.__cache={}),VlProzaMessage.__cache}static __getCacheForDomain(e){const t=VlProzaMessage.__domainCache;return t[e]||(t[e]={}),t[e]}static __getToegelatenOperatiesCacheForDomain(e){return VlProzaMessage.__getCacheForDomain(e).toegelatenOperaties}static __setToegelatenOperatiesCacheForDomain(e,t){VlProzaMessage.__getCacheForDomain(e).toegelatenOperaties=t}static __getMessageCacheForDomain(e){const t=VlProzaMessage.__getCacheForDomain(e);return t.messages||(t.messages={}),t.messages}async __processToegelatenOperaties(){(await VlProzaMessage._getToegelatenOperaties(this._domain)).update&&this._element.appendChild(this._getEditButtonTemplate())}};export class VlProzaMessagePreloader extends(VlElement(HTMLElement)){static get _observedAttributes(){return["data-vl-domain"]}constructor(){super(),this._preload()}_data_vl_domainChangedCallback(){this._preload()}get _domain(){return this.dataset.vlDomain}_preload(){this._domain&&VlProzaMessagePreloader._preload(this._domain)}static _preload(e){VlProzaMessagePreloader.isPreloaded(e)||VlProzaMessagePreloader.__setPreloadedMessagesCacheForDomain(e,ProzaRestClient.getMessages(e))}static getMessage(e,t){return VlProzaMessagePreloader._getMessages(e).then(a=>{const s=a[t];if(s)return s;throw Error(`Bericht voor {domein: ${e}, code: ${t}} niet gevonden`)})}static isPreloaded(e){return!!VlProzaMessagePreloader.__getPreloadedMessagesCacheForDomain(e)}static _getMessages(e){return VlProzaMessagePreloader.isPreloaded(e)?VlProzaMessagePreloader.__getPreloadedMessagesCacheForDomain(e):Promise.reject(new Error(`Berichten voor domein ${e} zijn niet preloaded`))}static get __domainCache(){return VlProzaMessagePreloader.__cache||(VlProzaMessagePreloader.__cache={}),VlProzaMessagePreloader.__cache}static __getCacheForDomain(e){const t=VlProzaMessagePreloader.__domainCache;return t[e]||(t[e]={}),t[e]}static __getPreloadedMessagesCacheForDomain(e){return VlProzaMessagePreloader.__getCacheForDomain(e).messages}static __setPreloadedMessagesCacheForDomain(e,t){VlProzaMessagePreloader.__getCacheForDomain(e).messages=t}};class ProzaRestClient{static getMessage(e,t){return ProzaRestClient.__fetchJson(`proza/domein/${e}/${t}`).then(e=>e.tekst).catch(a=>(console.error(`Er is iets fout gelopen bij het ophalen van het Proza bericht voor {domein: ${e}, code: ${t}}`,a),Promise.reject(a)))}static getMessages(e){return ProzaRestClient.__fetchJson(`proza/domein/${e}`).then(e=>Object.assign({},...e.map(e=>({[e.code]:e.tekst})))).catch(t=>(console.error(`Er is iets fout gelopen bij het ophalen van de Proza berichten voor domein ${e}`,t),Promise.reject(t)))}static getToegelatenOperaties(e){return ProzaRestClient.__fetchJson(`proza/domein/${e}/toegelatenoperaties`).catch(t=>(console.error(`Er is iets fout gelopen bij het ophalen van de toegelaten Proza operaties voor domein ${e}`,t),Promise.reject(t)))}static __fetchJson(e){return fetch(e).then(e=>{if(e.ok)return e.json();throw Error(`Response geeft aan dat er een fout is: ${e.statusText}`)})}}define("vl-proza-message-preloader",VlProzaMessagePreloader),define("vl-proza-message",VlProzaMessage);